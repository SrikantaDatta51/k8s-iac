{
    "__inputs": [],
    "__requires": [
        {
            "type": "grafana",
            "id": "grafana",
            "name": "Grafana",
            "version": "9.0.0"
        },
        {
            "type": "datasource",
            "id": "prometheus",
            "name": "Prometheus",
            "version": "1.0.0"
        }
    ],
    "id": null,
    "uid": "bmaas-04-workload-perf",
    "title": "BMaaS \u2014 04 Workload & Job Performance",
    "description": "GPU utilization during jobs, per-GPU clock/power, throttle/thermal, ECC error correlation, recovery checks, memory pressure.",
    "tags": [
        "bmaas",
        "workload",
        "job",
        "performance",
        "gpu",
        "utilization",
        "bcm11"
    ],
    "style": "dark",
    "timezone": "browser",
    "editable": true,
    "graphTooltip": 1,
    "fiscalYearStartMonth": 0,
    "liveNow": false,
    "refresh": "30s",
    "schemaVersion": 38,
    "version": 1,
    "time": {
        "from": "now-6h",
        "to": "now"
    },
    "timepicker": {},
    "annotations": {
        "list": [
            {
                "builtIn": 1,
                "datasource": {
                    "type": "grafana",
                    "uid": "-- Grafana --"
                },
                "enable": true,
                "hide": true,
                "iconColor": "rgba(0, 211, 255, 1)",
                "name": "Annotations & Alerts",
                "type": "dashboard"
            }
        ]
    },
    "templating": {
        "list": [
            {
                "name": "datasource",
                "type": "datasource",
                "label": "Data Source",
                "query": "prometheus",
                "current": {
                    "text": "Mimir BCM Metrics",
                    "value": "Mimir BCM Metrics"
                },
                "hide": 0,
                "includeAll": false,
                "multi": false,
                "options": [],
                "refresh": 1,
                "regex": "",
                "skipUrlSync": false
            },
            {
                "name": "cluster",
                "type": "query",
                "label": "Cluster",
                "datasource": {
                    "type": "prometheus",
                    "uid": "${datasource}"
                },
                "definition": "label_values(up, cluster)",
                "query": {
                    "query": "label_values(up, cluster)",
                    "refId": "cl"
                },
                "current": {
                    "text": "su56",
                    "value": "su56"
                },
                "hide": 0,
                "includeAll": false,
                "multi": false,
                "options": [],
                "refresh": 2,
                "regex": "",
                "sort": 1,
                "skipUrlSync": false
            },
            {
                "name": "node",
                "type": "query",
                "label": "Node (DGX)",
                "datasource": {
                    "type": "prometheus",
                    "uid": "${datasource}"
                },
                "definition": "label_values({cluster=~\"$cluster\"}, entity)",
                "query": {
                    "query": "label_values({cluster=~\"$cluster\"}, entity)",
                    "refId": "nd"
                },
                "current": {},
                "hide": 0,
                "includeAll": true,
                "multi": true,
                "allValue": ".*",
                "options": [],
                "refresh": 2,
                "regex": "/skt-dgx.*/",
                "sort": 1,
                "skipUrlSync": false
            }
        ]
    },
    "panels": [
        {
            "type": "row",
            "title": "GPU Compute Utilization",
            "collapsed": false,
            "gridPos": {
                "h": 1,
                "w": 24,
                "x": 0,
                "y": 0
            },
            "id": 1,
            "panels": []
        },
        {
            "id": 2,
            "title": "Fleet Average GPU Utilization",
            "description": "WHY: Fleet-wide GPU util is the primary revenue/efficiency KPI.\n\nFORMULA: avg(gpu_utilization) across all nodes in cluster.\nTARGET: > 70% = healthy. < 40% = wasted GPU capacity = revenue loss.",
            "type": "stat",
            "datasource": {
                "type": "prometheus",
                "uid": "${datasource}"
            },
            "gridPos": {
                "h": 6,
                "w": 4,
                "x": 0,
                "y": 1
            },
            "fieldConfig": {
                "defaults": {
                    "unit": "percent",
                    "decimals": 1,
                    "thresholds": {
                        "mode": "absolute",
                        "steps": [
                            {
                                "color": "#C04040",
                                "value": null
                            },
                            {
                                "color": "#E0A939",
                                "value": 40
                            },
                            {
                                "color": "#56A64B",
                                "value": 70
                            }
                        ]
                    },
                    "mappings": [],
                    "noValue": "N/A"
                },
                "overrides": []
            },
            "options": {
                "reduceOptions": {
                    "calcs": [
                        "lastNotNull"
                    ],
                    "fields": "",
                    "values": false
                },
                "orientation": "auto",
                "textMode": "value",
                "colorMode": "background",
                "graphMode": "none",
                "justifyMode": "center"
            },
            "targets": [
                {
                    "refId": "A",
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "expr": "avg(gpu_utilization{cluster=~\"$cluster\"})",
                    "legendFormat": "Avg Util",
                    "instant": true
                }
            ]
        },
        {
            "id": 3,
            "title": "GPU Utilization (per Entity)",
            "description": "WHY: Per-node GPU utilization shows which nodes are idle vs loaded.\n\nMETRIC: gpu_utilization \u2014 percentage of GPU compute used.\nACTION: Consistently low on specific nodes = scheduling issue.",
            "type": "timeseries",
            "datasource": {
                "type": "prometheus",
                "uid": "${datasource}"
            },
            "gridPos": {
                "h": 6,
                "w": 10,
                "x": 4,
                "y": 1
            },
            "fieldConfig": {
                "defaults": {
                    "unit": "percent",
                    "custom": {
                        "lineWidth": 2,
                        "fillOpacity": 10,
                        "gradientMode": "none",
                        "axisLabel": "Utilization %",
                        "drawStyle": "line",
                        "pointSize": 4,
                        "showPoints": "never",
                        "spanNulls": true
                    }
                },
                "overrides": []
            },
            "options": {
                "legend": {
                    "displayMode": "table",
                    "placement": "right",
                    "calcs": [
                        "min",
                        "max",
                        "mean",
                        "lastNotNull"
                    ],
                    "sortBy": "Last *",
                    "sortDesc": true
                },
                "tooltip": {
                    "mode": "multi",
                    "sort": "desc"
                }
            },
            "targets": [
                {
                    "refId": "A",
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "expr": "gpu_utilization{entity=~\"$node\",cluster=~\"$cluster\"}",
                    "legendFormat": "{{entity}}"
                }
            ]
        },
        {
            "id": 4,
            "title": "GPU Memory Utilization",
            "description": "WHY: HBM memory usage \u2014 high = workloads actively using GPU memory.\n\nMETRIC: total_gpu_memory_utilization.\nNOTE: Near 100% = risk of OOM on GPU. May need model optimization.",
            "type": "timeseries",
            "datasource": {
                "type": "prometheus",
                "uid": "${datasource}"
            },
            "gridPos": {
                "h": 6,
                "w": 10,
                "x": 14,
                "y": 1
            },
            "fieldConfig": {
                "defaults": {
                    "unit": "percent",
                    "custom": {
                        "lineWidth": 2,
                        "fillOpacity": 10,
                        "gradientMode": "none",
                        "axisLabel": "Memory Util %",
                        "drawStyle": "line",
                        "pointSize": 4,
                        "showPoints": "never",
                        "spanNulls": true
                    }
                },
                "overrides": []
            },
            "options": {
                "legend": {
                    "displayMode": "table",
                    "placement": "right",
                    "calcs": [
                        "min",
                        "max",
                        "mean",
                        "lastNotNull"
                    ],
                    "sortBy": "Last *",
                    "sortDesc": true
                },
                "tooltip": {
                    "mode": "multi",
                    "sort": "desc"
                }
            },
            "targets": [
                {
                    "refId": "A",
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "expr": "total_gpu_memory_utilization{entity=~\"$node\",cluster=~\"$cluster\"}",
                    "legendFormat": "{{entity}}"
                }
            ]
        },
        {
            "type": "row",
            "title": "Per-GPU Performance Under Load",
            "collapsed": false,
            "gridPos": {
                "h": 1,
                "w": 24,
                "x": 0,
                "y": 7
            },
            "id": 5,
            "panels": []
        },
        {
            "id": 6,
            "title": "GPU Clock Speed (All 8)",
            "description": "WHY: Clock speed directly affects compute throughput.\n\nMETRICS: gpu0_clock .. gpu7_clock.\nSIGNIFICANCE: Lower-than-expected during load = power/thermal throttling.",
            "type": "timeseries",
            "datasource": {
                "type": "prometheus",
                "uid": "${datasource}"
            },
            "gridPos": {
                "h": 6,
                "w": 12,
                "x": 0,
                "y": 8
            },
            "fieldConfig": {
                "defaults": {
                    "unit": "short",
                    "custom": {
                        "lineWidth": 2,
                        "fillOpacity": 10,
                        "gradientMode": "none",
                        "axisLabel": "Clock (MHz)",
                        "drawStyle": "line",
                        "pointSize": 4,
                        "showPoints": "never",
                        "spanNulls": true
                    }
                },
                "overrides": []
            },
            "options": {
                "legend": {
                    "displayMode": "table",
                    "placement": "right",
                    "calcs": [
                        "min",
                        "max",
                        "mean",
                        "lastNotNull"
                    ],
                    "sortBy": "Last *",
                    "sortDesc": true
                },
                "tooltip": {
                    "mode": "multi",
                    "sort": "desc"
                }
            },
            "targets": [
                {
                    "refId": "A",
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "expr": "gpu0_clock{entity=~\"$node\",cluster=~\"$cluster\"}",
                    "legendFormat": "{{entity}} GPU0"
                },
                {
                    "refId": "B",
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "expr": "gpu1_clock{entity=~\"$node\",cluster=~\"$cluster\"}",
                    "legendFormat": "{{entity}} GPU1"
                },
                {
                    "refId": "C",
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "expr": "gpu2_clock{entity=~\"$node\",cluster=~\"$cluster\"}",
                    "legendFormat": "{{entity}} GPU2"
                },
                {
                    "refId": "D",
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "expr": "gpu3_clock{entity=~\"$node\",cluster=~\"$cluster\"}",
                    "legendFormat": "{{entity}} GPU3"
                },
                {
                    "refId": "E",
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "expr": "gpu4_clock{entity=~\"$node\",cluster=~\"$cluster\"}",
                    "legendFormat": "{{entity}} GPU4"
                },
                {
                    "refId": "F",
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "expr": "gpu5_clock{entity=~\"$node\",cluster=~\"$cluster\"}",
                    "legendFormat": "{{entity}} GPU5"
                },
                {
                    "refId": "G",
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "expr": "gpu6_clock{entity=~\"$node\",cluster=~\"$cluster\"}",
                    "legendFormat": "{{entity}} GPU6"
                },
                {
                    "refId": "H",
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "expr": "gpu7_clock{entity=~\"$node\",cluster=~\"$cluster\"}",
                    "legendFormat": "{{entity}} GPU7"
                }
            ]
        },
        {
            "id": 7,
            "title": "GPU Performance State",
            "description": "WHY: P-state indicates GPU power mode during workload.\n\nMETRICS: gpu0_perfstate .. gpu7_perfstate.\nEXPECTED: P0 during active training. P8 = idle GPU (not utilized).",
            "type": "timeseries",
            "datasource": {
                "type": "prometheus",
                "uid": "${datasource}"
            },
            "gridPos": {
                "h": 6,
                "w": 12,
                "x": 12,
                "y": 8
            },
            "fieldConfig": {
                "defaults": {
                    "unit": "short",
                    "custom": {
                        "lineWidth": 2,
                        "fillOpacity": 10,
                        "gradientMode": "none",
                        "axisLabel": "PerfState",
                        "drawStyle": "line",
                        "pointSize": 4,
                        "showPoints": "never",
                        "spanNulls": true
                    }
                },
                "overrides": []
            },
            "options": {
                "legend": {
                    "displayMode": "table",
                    "placement": "right",
                    "calcs": [
                        "min",
                        "max",
                        "mean",
                        "lastNotNull"
                    ],
                    "sortBy": "Last *",
                    "sortDesc": true
                },
                "tooltip": {
                    "mode": "multi",
                    "sort": "desc"
                }
            },
            "targets": [
                {
                    "refId": "A",
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "expr": "gpu0_perfstate{entity=~\"$node\",cluster=~\"$cluster\"}",
                    "legendFormat": "{{entity}} GPU0"
                },
                {
                    "refId": "B",
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "expr": "gpu1_perfstate{entity=~\"$node\",cluster=~\"$cluster\"}",
                    "legendFormat": "{{entity}} GPU1"
                },
                {
                    "refId": "C",
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "expr": "gpu2_perfstate{entity=~\"$node\",cluster=~\"$cluster\"}",
                    "legendFormat": "{{entity}} GPU2"
                },
                {
                    "refId": "D",
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "expr": "gpu3_perfstate{entity=~\"$node\",cluster=~\"$cluster\"}",
                    "legendFormat": "{{entity}} GPU3"
                },
                {
                    "refId": "E",
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "expr": "gpu4_perfstate{entity=~\"$node\",cluster=~\"$cluster\"}",
                    "legendFormat": "{{entity}} GPU4"
                },
                {
                    "refId": "F",
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "expr": "gpu5_perfstate{entity=~\"$node\",cluster=~\"$cluster\"}",
                    "legendFormat": "{{entity}} GPU5"
                },
                {
                    "refId": "G",
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "expr": "gpu6_perfstate{entity=~\"$node\",cluster=~\"$cluster\"}",
                    "legendFormat": "{{entity}} GPU6"
                },
                {
                    "refId": "H",
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "expr": "gpu7_perfstate{entity=~\"$node\",cluster=~\"$cluster\"}",
                    "legendFormat": "{{entity}} GPU7"
                }
            ]
        },
        {
            "type": "row",
            "title": "Power During Workload",
            "collapsed": false,
            "gridPos": {
                "h": 1,
                "w": 24,
                "x": 0,
                "y": 14
            },
            "id": 8,
            "panels": []
        },
        {
            "id": 9,
            "title": "GPU Power per Entity",
            "description": "WHY: GPU power correlates with compute activity. Low power during job = issue.\n\nMETRIC: gpu_power_usage.\nEXPECTED: Near 8kW (8\u00d71000W TDP) during full training run.",
            "type": "timeseries",
            "datasource": {
                "type": "prometheus",
                "uid": "${datasource}"
            },
            "gridPos": {
                "h": 6,
                "w": 8,
                "x": 0,
                "y": 15
            },
            "fieldConfig": {
                "defaults": {
                    "unit": "watt",
                    "custom": {
                        "lineWidth": 2,
                        "fillOpacity": 10,
                        "gradientMode": "none",
                        "axisLabel": "Power",
                        "drawStyle": "line",
                        "pointSize": 4,
                        "showPoints": "never",
                        "spanNulls": true
                    }
                },
                "overrides": []
            },
            "options": {
                "legend": {
                    "displayMode": "table",
                    "placement": "right",
                    "calcs": [
                        "min",
                        "max",
                        "mean",
                        "lastNotNull"
                    ],
                    "sortBy": "Last *",
                    "sortDesc": true
                },
                "tooltip": {
                    "mode": "multi",
                    "sort": "desc"
                }
            },
            "targets": [
                {
                    "refId": "A",
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "expr": "gpu_power_usage{entity=~\"$node\",cluster=~\"$cluster\"}",
                    "legendFormat": "{{entity}}"
                }
            ]
        },
        {
            "id": 10,
            "title": "Per-GPU Power (All 8)",
            "description": "WHY: Identify specific GPUs drawing less power = possible throttling.\n\nMETRICS: gpu0_power .. gpu7_power.",
            "type": "timeseries",
            "datasource": {
                "type": "prometheus",
                "uid": "${datasource}"
            },
            "gridPos": {
                "h": 6,
                "w": 8,
                "x": 8,
                "y": 15
            },
            "fieldConfig": {
                "defaults": {
                    "unit": "watt",
                    "custom": {
                        "lineWidth": 2,
                        "fillOpacity": 10,
                        "gradientMode": "none",
                        "axisLabel": "Power",
                        "drawStyle": "line",
                        "pointSize": 4,
                        "showPoints": "never",
                        "spanNulls": true
                    }
                },
                "overrides": []
            },
            "options": {
                "legend": {
                    "displayMode": "table",
                    "placement": "right",
                    "calcs": [
                        "min",
                        "max",
                        "mean",
                        "lastNotNull"
                    ],
                    "sortBy": "Last *",
                    "sortDesc": true
                },
                "tooltip": {
                    "mode": "multi",
                    "sort": "desc"
                }
            },
            "targets": [
                {
                    "refId": "A",
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "expr": "gpu0_power{entity=~\"$node\",cluster=~\"$cluster\"}",
                    "legendFormat": "{{entity}} GPU0"
                },
                {
                    "refId": "B",
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "expr": "gpu1_power{entity=~\"$node\",cluster=~\"$cluster\"}",
                    "legendFormat": "{{entity}} GPU1"
                },
                {
                    "refId": "C",
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "expr": "gpu2_power{entity=~\"$node\",cluster=~\"$cluster\"}",
                    "legendFormat": "{{entity}} GPU2"
                },
                {
                    "refId": "D",
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "expr": "gpu3_power{entity=~\"$node\",cluster=~\"$cluster\"}",
                    "legendFormat": "{{entity}} GPU3"
                },
                {
                    "refId": "E",
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "expr": "gpu4_power{entity=~\"$node\",cluster=~\"$cluster\"}",
                    "legendFormat": "{{entity}} GPU4"
                },
                {
                    "refId": "F",
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "expr": "gpu5_power{entity=~\"$node\",cluster=~\"$cluster\"}",
                    "legendFormat": "{{entity}} GPU5"
                },
                {
                    "refId": "G",
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "expr": "gpu6_power{entity=~\"$node\",cluster=~\"$cluster\"}",
                    "legendFormat": "{{entity}} GPU6"
                },
                {
                    "refId": "H",
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "expr": "gpu7_power{entity=~\"$node\",cluster=~\"$cluster\"}",
                    "legendFormat": "{{entity}} GPU7"
                }
            ]
        },
        {
            "id": 11,
            "title": "Power Limit vs Actual",
            "description": "WHY: Gap between limit and actual = either idle or throttled.\n\nMETRICS: GPU_enforced_power_limit vs gpu_power_usage.\nSIGNIFICANCE: If actual << limit during load, investigate throttling.",
            "type": "timeseries",
            "datasource": {
                "type": "prometheus",
                "uid": "${datasource}"
            },
            "gridPos": {
                "h": 6,
                "w": 8,
                "x": 16,
                "y": 15
            },
            "fieldConfig": {
                "defaults": {
                    "unit": "watt",
                    "custom": {
                        "lineWidth": 2,
                        "fillOpacity": 10,
                        "gradientMode": "none",
                        "axisLabel": "Watts",
                        "drawStyle": "line",
                        "pointSize": 4,
                        "showPoints": "never",
                        "spanNulls": true
                    }
                },
                "overrides": []
            },
            "options": {
                "legend": {
                    "displayMode": "table",
                    "placement": "right",
                    "calcs": [
                        "min",
                        "max",
                        "mean",
                        "lastNotNull"
                    ],
                    "sortBy": "Last *",
                    "sortDesc": true
                },
                "tooltip": {
                    "mode": "multi",
                    "sort": "desc"
                }
            },
            "targets": [
                {
                    "refId": "A",
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "expr": "GPU_enforced_power_limit{entity=~\"$node\",cluster=~\"$cluster\"}",
                    "legendFormat": "{{entity}} Limit"
                },
                {
                    "refId": "B",
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "expr": "gpu_power_usage{entity=~\"$node\",cluster=~\"$cluster\"}",
                    "legendFormat": "{{entity}} Actual"
                }
            ]
        },
        {
            "type": "row",
            "title": "Throttle & Thermal Under Load",
            "collapsed": false,
            "gridPos": {
                "h": 1,
                "w": 24,
                "x": 0,
                "y": 21
            },
            "id": 12,
            "panels": []
        },
        {
            "id": 13,
            "title": "GPU Throttle Events",
            "description": "WHY: Throttling = forced clock reduction. Performance loss for running jobs.\n\nMETRICS: gpu0_throttle .. gpu7_throttle \u2014 0 = no throttle.\nACTION: Sustained > 0 = check CDU cooling, power supply, ambient temp.",
            "type": "timeseries",
            "datasource": {
                "type": "prometheus",
                "uid": "${datasource}"
            },
            "gridPos": {
                "h": 6,
                "w": 8,
                "x": 0,
                "y": 22
            },
            "fieldConfig": {
                "defaults": {
                    "unit": "short",
                    "custom": {
                        "lineWidth": 2,
                        "fillOpacity": 10,
                        "gradientMode": "none",
                        "axisLabel": "Throttle",
                        "drawStyle": "line",
                        "pointSize": 4,
                        "showPoints": "never",
                        "spanNulls": true
                    }
                },
                "overrides": []
            },
            "options": {
                "legend": {
                    "displayMode": "table",
                    "placement": "right",
                    "calcs": [
                        "min",
                        "max",
                        "mean",
                        "lastNotNull"
                    ],
                    "sortBy": "Last *",
                    "sortDesc": true
                },
                "tooltip": {
                    "mode": "multi",
                    "sort": "desc"
                }
            },
            "targets": [
                {
                    "refId": "A",
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "expr": "gpu0_throttle{entity=~\"$node\",cluster=~\"$cluster\"}",
                    "legendFormat": "{{entity}} GPU0"
                },
                {
                    "refId": "B",
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "expr": "gpu1_throttle{entity=~\"$node\",cluster=~\"$cluster\"}",
                    "legendFormat": "{{entity}} GPU1"
                },
                {
                    "refId": "C",
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "expr": "gpu2_throttle{entity=~\"$node\",cluster=~\"$cluster\"}",
                    "legendFormat": "{{entity}} GPU2"
                },
                {
                    "refId": "D",
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "expr": "gpu3_throttle{entity=~\"$node\",cluster=~\"$cluster\"}",
                    "legendFormat": "{{entity}} GPU3"
                },
                {
                    "refId": "E",
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "expr": "gpu4_throttle{entity=~\"$node\",cluster=~\"$cluster\"}",
                    "legendFormat": "{{entity}} GPU4"
                },
                {
                    "refId": "F",
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "expr": "gpu5_throttle{entity=~\"$node\",cluster=~\"$cluster\"}",
                    "legendFormat": "{{entity}} GPU5"
                },
                {
                    "refId": "G",
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "expr": "gpu6_throttle{entity=~\"$node\",cluster=~\"$cluster\"}",
                    "legendFormat": "{{entity}} GPU6"
                },
                {
                    "refId": "H",
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "expr": "gpu7_throttle{entity=~\"$node\",cluster=~\"$cluster\"}",
                    "legendFormat": "{{entity}} GPU7"
                }
            ]
        },
        {
            "id": 14,
            "title": "GPU Temperature Under Load",
            "description": "WHY: Thermal monitoring during active workload.\n\nMETRICS: gpu0_temperature .. gpu7_temperature.\nTHRESHOLD: > 83\u00b0C = throttle risk. > 90\u00b0C = cooling failure.",
            "type": "timeseries",
            "datasource": {
                "type": "prometheus",
                "uid": "${datasource}"
            },
            "gridPos": {
                "h": 6,
                "w": 8,
                "x": 8,
                "y": 22
            },
            "fieldConfig": {
                "defaults": {
                    "unit": "celsius",
                    "custom": {
                        "lineWidth": 2,
                        "fillOpacity": 10,
                        "gradientMode": "none",
                        "axisLabel": "Temperature",
                        "drawStyle": "line",
                        "pointSize": 4,
                        "showPoints": "never",
                        "spanNulls": true
                    }
                },
                "overrides": []
            },
            "options": {
                "legend": {
                    "displayMode": "table",
                    "placement": "right",
                    "calcs": [
                        "min",
                        "max",
                        "mean",
                        "lastNotNull"
                    ],
                    "sortBy": "Last *",
                    "sortDesc": true
                },
                "tooltip": {
                    "mode": "multi",
                    "sort": "desc"
                }
            },
            "targets": [
                {
                    "refId": "A",
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "expr": "gpu0_temperature{entity=~\"$node\",cluster=~\"$cluster\"}",
                    "legendFormat": "{{entity}} GPU0"
                },
                {
                    "refId": "B",
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "expr": "gpu1_temperature{entity=~\"$node\",cluster=~\"$cluster\"}",
                    "legendFormat": "{{entity}} GPU1"
                },
                {
                    "refId": "C",
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "expr": "gpu2_temperature{entity=~\"$node\",cluster=~\"$cluster\"}",
                    "legendFormat": "{{entity}} GPU2"
                },
                {
                    "refId": "D",
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "expr": "gpu3_temperature{entity=~\"$node\",cluster=~\"$cluster\"}",
                    "legendFormat": "{{entity}} GPU3"
                },
                {
                    "refId": "E",
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "expr": "gpu4_temperature{entity=~\"$node\",cluster=~\"$cluster\"}",
                    "legendFormat": "{{entity}} GPU4"
                },
                {
                    "refId": "F",
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "expr": "gpu5_temperature{entity=~\"$node\",cluster=~\"$cluster\"}",
                    "legendFormat": "{{entity}} GPU5"
                },
                {
                    "refId": "G",
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "expr": "gpu6_temperature{entity=~\"$node\",cluster=~\"$cluster\"}",
                    "legendFormat": "{{entity}} GPU6"
                },
                {
                    "refId": "H",
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "expr": "gpu7_temperature{entity=~\"$node\",cluster=~\"$cluster\"}",
                    "legendFormat": "{{entity}} GPU7"
                }
            ]
        },
        {
            "id": 15,
            "title": "Thermal & Board Limit Violations",
            "description": "WHY: Violation events during workload = performance impact.\n\nMETRICS: GPU_thermal_violation, gpu_board_limit_violation, gpu_reliability_violation.\nSIGNIFICANCE: Frequent = hardware approaching limits.",
            "type": "timeseries",
            "datasource": {
                "type": "prometheus",
                "uid": "${datasource}"
            },
            "gridPos": {
                "h": 6,
                "w": 8,
                "x": 16,
                "y": 22
            },
            "fieldConfig": {
                "defaults": {
                    "unit": "short",
                    "custom": {
                        "lineWidth": 2,
                        "fillOpacity": 10,
                        "gradientMode": "none",
                        "axisLabel": "Violations",
                        "drawStyle": "line",
                        "pointSize": 4,
                        "showPoints": "never",
                        "spanNulls": true
                    }
                },
                "overrides": []
            },
            "options": {
                "legend": {
                    "displayMode": "table",
                    "placement": "right",
                    "calcs": [
                        "min",
                        "max",
                        "mean",
                        "lastNotNull"
                    ],
                    "sortBy": "Last *",
                    "sortDesc": true
                },
                "tooltip": {
                    "mode": "multi",
                    "sort": "desc"
                }
            },
            "targets": [
                {
                    "refId": "A",
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "expr": "GPU_thermal_violation{entity=~\"$node\",cluster=~\"$cluster\"}",
                    "legendFormat": "{{entity}} Thermal"
                },
                {
                    "refId": "B",
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "expr": "gpu_board_limit_violation{entity=~\"$node\",cluster=~\"$cluster\"}",
                    "legendFormat": "{{entity}} Board"
                },
                {
                    "refId": "C",
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "expr": "gpu_reliability_violation{entity=~\"$node\",cluster=~\"$cluster\"}",
                    "legendFormat": "{{entity}} Reliability"
                }
            ]
        },
        {
            "type": "row",
            "title": "ECC Error Correlation During Workload",
            "collapsed": false,
            "gridPos": {
                "h": 1,
                "w": 24,
                "x": 0,
                "y": 28
            },
            "id": 16,
            "panels": []
        },
        {
            "id": 17,
            "title": "ECC Errors (Volatile / Since Reset)",
            "description": "WHY: Volatile ECC counters show errors that occurred during current workload.\n\nMETRICS: gpu_ecc_sbe_vol (correctable) + gpu_ecc_dbe_vol (UNCORRECTABLE).\nACTION: DBE during workload = job results are UNRELIABLE. Stop and replace GPU.",
            "type": "timeseries",
            "datasource": {
                "type": "prometheus",
                "uid": "${datasource}"
            },
            "gridPos": {
                "h": 6,
                "w": 8,
                "x": 0,
                "y": 29
            },
            "fieldConfig": {
                "defaults": {
                    "unit": "short",
                    "custom": {
                        "lineWidth": 2,
                        "fillOpacity": 10,
                        "gradientMode": "none",
                        "axisLabel": "ECC Errors",
                        "drawStyle": "line",
                        "pointSize": 4,
                        "showPoints": "never",
                        "spanNulls": true
                    }
                },
                "overrides": []
            },
            "options": {
                "legend": {
                    "displayMode": "table",
                    "placement": "right",
                    "calcs": [
                        "min",
                        "max",
                        "mean",
                        "lastNotNull"
                    ],
                    "sortBy": "Last *",
                    "sortDesc": true
                },
                "tooltip": {
                    "mode": "multi",
                    "sort": "desc"
                }
            },
            "targets": [
                {
                    "refId": "A",
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "expr": "gpu_ecc_sbe_vol{entity=~\"$node\",cluster=~\"$cluster\"}",
                    "legendFormat": "{{entity}} SBE"
                },
                {
                    "refId": "B",
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "expr": "gpu_ecc_dbe_vol{entity=~\"$node\",cluster=~\"$cluster\"}",
                    "legendFormat": "{{entity}} DBE"
                }
            ]
        },
        {
            "id": 18,
            "title": "GPU Recovery Checks",
            "description": "WHY: Automatic GPU recovery = DCGM detected a problem and tried to fix it.\n\nMETRIC: gpu_recovery_check \u2014 counter of recovery attempts.\nACTION: Frequent = GPU is unstable, schedule maintenance.",
            "type": "timeseries",
            "datasource": {
                "type": "prometheus",
                "uid": "${datasource}"
            },
            "gridPos": {
                "h": 6,
                "w": 8,
                "x": 8,
                "y": 29
            },
            "fieldConfig": {
                "defaults": {
                    "unit": "short",
                    "custom": {
                        "lineWidth": 2,
                        "fillOpacity": 10,
                        "gradientMode": "none",
                        "axisLabel": "Recovery Events",
                        "drawStyle": "line",
                        "pointSize": 4,
                        "showPoints": "never",
                        "spanNulls": true
                    }
                },
                "overrides": []
            },
            "options": {
                "legend": {
                    "displayMode": "table",
                    "placement": "right",
                    "calcs": [
                        "min",
                        "max",
                        "mean",
                        "lastNotNull"
                    ],
                    "sortBy": "Last *",
                    "sortDesc": true
                },
                "tooltip": {
                    "mode": "multi",
                    "sort": "desc"
                }
            },
            "targets": [
                {
                    "refId": "A",
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "expr": "gpu_recovery_check{entity=~\"$node\",cluster=~\"$cluster\"}",
                    "legendFormat": "{{entity}}"
                }
            ]
        },
        {
            "id": 19,
            "title": "ECC Clock Violations",
            "description": "WHY: ECC checking overhead impacting GPU clock speed.\n\nMETRIC: gpu_total_ecc_clocks_violation.\nSIGNIFICANCE: Trade-off between reliability and performance.",
            "type": "timeseries",
            "datasource": {
                "type": "prometheus",
                "uid": "${datasource}"
            },
            "gridPos": {
                "h": 6,
                "w": 8,
                "x": 16,
                "y": 29
            },
            "fieldConfig": {
                "defaults": {
                    "unit": "short",
                    "custom": {
                        "lineWidth": 2,
                        "fillOpacity": 10,
                        "gradientMode": "none",
                        "axisLabel": "Violations",
                        "drawStyle": "line",
                        "pointSize": 4,
                        "showPoints": "never",
                        "spanNulls": true
                    }
                },
                "overrides": []
            },
            "options": {
                "legend": {
                    "displayMode": "table",
                    "placement": "right",
                    "calcs": [
                        "min",
                        "max",
                        "mean",
                        "lastNotNull"
                    ],
                    "sortBy": "Last *",
                    "sortDesc": true
                },
                "tooltip": {
                    "mode": "multi",
                    "sort": "desc"
                }
            },
            "targets": [
                {
                    "refId": "A",
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "expr": "gpu_total_ecc_clocks_violation{entity=~\"$node\",cluster=~\"$cluster\"}",
                    "legendFormat": "{{entity}}"
                }
            ]
        },
        {
            "type": "row",
            "title": "System Memory Pressure",
            "collapsed": false,
            "gridPos": {
                "h": 1,
                "w": 24,
                "x": 0,
                "y": 35
            },
            "id": 20,
            "panels": []
        },
        {
            "id": 21,
            "title": "System Memory Utilization",
            "description": "WHY: Host memory pressure can cause OOM kills, affecting GPU jobs.\n\nMETRIC: memory_utilization.\nACTION: > 90% = risk. > 95% = OOM imminent.",
            "type": "timeseries",
            "datasource": {
                "type": "prometheus",
                "uid": "${datasource}"
            },
            "gridPos": {
                "h": 6,
                "w": 6,
                "x": 0,
                "y": 36
            },
            "fieldConfig": {
                "defaults": {
                    "unit": "percent",
                    "custom": {
                        "lineWidth": 2,
                        "fillOpacity": 10,
                        "gradientMode": "none",
                        "axisLabel": "Utilization %",
                        "drawStyle": "line",
                        "pointSize": 4,
                        "showPoints": "never",
                        "spanNulls": true
                    }
                },
                "overrides": []
            },
            "options": {
                "legend": {
                    "displayMode": "table",
                    "placement": "right",
                    "calcs": [
                        "min",
                        "max",
                        "mean",
                        "lastNotNull"
                    ],
                    "sortBy": "Last *",
                    "sortDesc": true
                },
                "tooltip": {
                    "mode": "multi",
                    "sort": "desc"
                }
            },
            "targets": [
                {
                    "refId": "A",
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "expr": "memory_utilization{entity=~\"$node\",cluster=~\"$cluster\"}",
                    "legendFormat": "{{entity}}"
                }
            ]
        },
        {
            "id": 22,
            "title": "Swap Activity",
            "description": "WHY: Swap usage = system ran out of RAM. TERRIBLE for GPU workloads.\n\nMETRICS: swap_used + swap_total.\nACTION: swap_used > 0 during GPU job = memory leak or overcommit.",
            "type": "timeseries",
            "datasource": {
                "type": "prometheus",
                "uid": "${datasource}"
            },
            "gridPos": {
                "h": 6,
                "w": 6,
                "x": 6,
                "y": 36
            },
            "fieldConfig": {
                "defaults": {
                    "unit": "decbytes",
                    "custom": {
                        "lineWidth": 2,
                        "fillOpacity": 10,
                        "gradientMode": "none",
                        "axisLabel": "Swap",
                        "drawStyle": "line",
                        "pointSize": 4,
                        "showPoints": "never",
                        "spanNulls": true
                    }
                },
                "overrides": []
            },
            "options": {
                "legend": {
                    "displayMode": "table",
                    "placement": "right",
                    "calcs": [
                        "min",
                        "max",
                        "mean",
                        "lastNotNull"
                    ],
                    "sortBy": "Last *",
                    "sortDesc": true
                },
                "tooltip": {
                    "mode": "multi",
                    "sort": "desc"
                }
            },
            "targets": [
                {
                    "refId": "A",
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "expr": "swap_used{entity=~\"$node\",cluster=~\"$cluster\"}",
                    "legendFormat": "{{entity}} Used"
                },
                {
                    "refId": "B",
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "expr": "swap_total{entity=~\"$node\",cluster=~\"$cluster\"}",
                    "legendFormat": "{{entity}} Total"
                }
            ]
        },
        {
            "id": 23,
            "title": "System Load vs Cores",
            "description": "WHY: Load > core count = CPU oversubscribed, bottlenecking GPU.\n\nMETRICS: load_one + cores_total.\nRULE: load_one < cores_total = healthy.",
            "type": "timeseries",
            "datasource": {
                "type": "prometheus",
                "uid": "${datasource}"
            },
            "gridPos": {
                "h": 6,
                "w": 6,
                "x": 12,
                "y": 36
            },
            "fieldConfig": {
                "defaults": {
                    "unit": "short",
                    "custom": {
                        "lineWidth": 2,
                        "fillOpacity": 10,
                        "gradientMode": "none",
                        "axisLabel": "Count",
                        "drawStyle": "line",
                        "pointSize": 4,
                        "showPoints": "never",
                        "spanNulls": true
                    }
                },
                "overrides": []
            },
            "options": {
                "legend": {
                    "displayMode": "table",
                    "placement": "right",
                    "calcs": [
                        "min",
                        "max",
                        "mean",
                        "lastNotNull"
                    ],
                    "sortBy": "Last *",
                    "sortDesc": true
                },
                "tooltip": {
                    "mode": "multi",
                    "sort": "desc"
                }
            },
            "targets": [
                {
                    "refId": "A",
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "expr": "load_one{entity=~\"$node\",cluster=~\"$cluster\"}",
                    "legendFormat": "{{entity}} Load 1m"
                },
                {
                    "refId": "B",
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "expr": "cores_total{entity=~\"$node\",cluster=~\"$cluster\"}",
                    "legendFormat": "{{entity}} Cores"
                }
            ]
        },
        {
            "id": 24,
            "title": "Paging Activity",
            "description": "WHY: High paging = kernel swapping memory pages. Severe GPU workload impact.\n\nMETRICS: paging_in + paging_out.\nACTION: Sustained high paging = add RAM or reduce workload count.",
            "type": "timeseries",
            "datasource": {
                "type": "prometheus",
                "uid": "${datasource}"
            },
            "gridPos": {
                "h": 6,
                "w": 6,
                "x": 18,
                "y": 36
            },
            "fieldConfig": {
                "defaults": {
                    "unit": "short",
                    "custom": {
                        "lineWidth": 2,
                        "fillOpacity": 10,
                        "gradientMode": "none",
                        "axisLabel": "Pages/s",
                        "drawStyle": "line",
                        "pointSize": 4,
                        "showPoints": "never",
                        "spanNulls": true
                    }
                },
                "overrides": []
            },
            "options": {
                "legend": {
                    "displayMode": "table",
                    "placement": "right",
                    "calcs": [
                        "min",
                        "max",
                        "mean",
                        "lastNotNull"
                    ],
                    "sortBy": "Last *",
                    "sortDesc": true
                },
                "tooltip": {
                    "mode": "multi",
                    "sort": "desc"
                }
            },
            "targets": [
                {
                    "refId": "A",
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "expr": "paging_in{entity=~\"$node\",cluster=~\"$cluster\"}",
                    "legendFormat": "{{entity}} PageIn"
                },
                {
                    "refId": "B",
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "expr": "paging_out{entity=~\"$node\",cluster=~\"$cluster\"}",
                    "legendFormat": "{{entity}} PageOut"
                }
            ]
        }
    ],
    "links": [
        {
            "title": "00 Executive Fleet Overview",
            "type": "link",
            "icon": "dashboard",
            "url": "/d/bmaas-00-fleet-overview?orgId=1&var-datasource=${datasource}&var-node=${node}&var-cluster=${cluster}",
            "targetBlank": false
        },
        {
            "title": "01 GPU Health & Diagnostics",
            "type": "link",
            "icon": "dashboard",
            "url": "/d/bmaas-01-gpu-health?orgId=1&var-datasource=${datasource}&var-node=${node}&var-cluster=${cluster}",
            "targetBlank": false
        },
        {
            "title": "02 Infrastructure & Hardware",
            "type": "link",
            "icon": "dashboard",
            "url": "/d/bmaas-02-infra-health?orgId=1&var-datasource=${datasource}&var-node=${node}&var-cluster=${cluster}",
            "targetBlank": false
        },
        {
            "title": "03 Network Fabric",
            "type": "link",
            "icon": "dashboard",
            "url": "/d/bmaas-03-network-fabric?orgId=1&var-datasource=${datasource}&var-node=${node}&var-cluster=${cluster}",
            "targetBlank": false
        },
        {
            "title": "04 Workload & Jobs",
            "type": "link",
            "icon": "dashboard",
            "url": "/d/bmaas-04-workload-perf?orgId=1&var-datasource=${datasource}&var-node=${node}&var-cluster=${cluster}",
            "targetBlank": false
        }
    ]
}